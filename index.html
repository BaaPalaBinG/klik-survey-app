<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Garage App ‚Äì Prototype v1</title>
  <style>
    :root{
      --bg:#0f1115; --card:#171a21; --muted:#a8b0bf; --text:#eef2fb;
      --line:rgba(255,255,255,.08);
      --good:#3ddc84; --warn:#ffcc00; --bad:#ff4d4d;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font:16px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg); color:var(--text);
    }
    .app{max-width:520px; margin:0 auto; padding:16px 14px 88px;}
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px; margin:6px 0 14px;}
    .title{font-size:18px; font-weight:700; letter-spacing:.2px}
    .sub{font-size:13px; color:var(--muted); margin-top:2px}
    .pill{
      border:1px solid var(--line); background:transparent; color:var(--text);
      padding:10px 12px; border-radius:14px; font-weight:650; cursor:pointer;
    }
    .pill:active{transform:translateY(1px)}
    .primary{
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
    }
    .stack{display:flex; flex-direction:column; gap:10px;}
    .card{
      background:var(--card); border:1px solid var(--line);
      border-radius:16px; padding:14px 14px;
    }
    .row{display:flex; align-items:center; justify-content:space-between; gap:12px;}
    .h{font-weight:750}
    .meta{color:var(--muted); font-size:13px; margin-top:6px}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px; border-radius:999px; border:1px solid var(--line);
      font-size:13px; color:var(--muted);
    }
    .dot{width:10px; height:10px; border-radius:50%}
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
      min-width:92px;
      text-align:center;
    }
    .btn:active{transform:translateY(1px)}
    .footerNav{
      position:fixed; left:0; right:0; bottom:0;
      padding:10px 12px calc(10px + env(safe-area-inset-bottom));
      background:rgba(15,17,21,.88);
      backdrop-filter: blur(10px);
      border-top:1px solid var(--line);
    }
    .navInner{max-width:520px; margin:0 auto; display:flex; gap:10px;}
    .navInner .btn{flex:1; min-width:0}
    .screen{display:none}
    .screen.active{display:block}
    .sectionTitle{font-size:13px; color:var(--muted); margin:14px 2px 8px}
    .field{
      display:flex; flex-direction:column; gap:6px;
      padding:12px; border-radius:14px; border:1px solid var(--line);
      background:rgba(255,255,255,.03);
    }
    label{font-size:12px; color:var(--muted)}
    input, select, textarea{
      width:100%;
      font:inherit;
      color:var(--text);
      background:transparent;
      border:1px solid rgba(255,255,255,.12);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
    }
    textarea{min-height:90px; resize:vertical}
    details{
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      border-radius:14px;
      overflow:hidden;
    }
    summary{
      list-style:none;
      cursor:pointer;
      padding:12px 12px;
      font-weight:750;
      display:flex; align-items:center; justify-content:space-between;
    }
    summary::-webkit-details-marker{display:none}
    .detailsBody{padding:0 12px 12px; color:var(--muted)}
    .kpi{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .kpi .chip{color:var(--text)}
    .muted{color:var(--muted)}
    .spacer{height:8px}
    .danger{border-color:rgba(255,77,77,.25)}
    .ok{border-color:rgba(61,220,132,.25)}
    .warn{border-color:rgba(255,204,0,.25)}
  </style>
</head>
<body>
  <div class="app">

    <!-- SCHERM 1: Vandaag -->
    <section id="screen-today" class="screen active">
      <div class="topbar">
        <div>
          <div class="title">Vandaag</div>
          <div id="todayDate" class="sub"></div>
        </div>
        <button class="pill primary" id="btnNewJob">+ Nieuwe klus</button>
      </div>

      <div class="sectionTitle">Werk voor vandaag</div>
      <div id="todayList" class="stack"></div>
    </section>

    <!-- SCHERM 2: Klus detail -->
    <section id="screen-job" class="screen">
      <div class="topbar">
        <button class="pill" id="btnBackToToday">‚Üê Vandaag</button>
        <div style="flex:1; min-width:0">
          <div id="jobTitle" class="title" style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">Klus</div>
          <div id="jobSub" class="sub"></div>
        </div>
      </div>

      <div class="card">
        <div class="row">
          <div class="h">Status</div>
          <select id="jobStatus">
            <option value="bezig">Bezig</option>
            <option value="wachten">Wachten</option>
            <option value="klaar">Klaar</option>
          </select>
        </div>

        <div class="kpi">
          <span id="chipStatus" class="chip"><span class="dot" id="chipDot"></span><span id="chipText">‚Äî</span></span>
          <span class="chip">Laatste update: <span id="chipUpdated">‚Äî</span></span>
        </div>
      </div>

      <div class="spacer"></div>

      <details>
        <summary>Werkzaamheden <span class="muted">‚ñæ</span></summary>
        <div class="detailsBody">
          <div class="field">
            <label>Notities</label>
            <textarea id="jobWork" placeholder="Bijv: olie + filter, bougies, uitlezen foutcodes..."></textarea>
          </div>
        </div>
      </details>

      <div class="spacer"></div>

      <details>
        <summary>Onderdelen / kosten <span class="muted">‚ñæ</span></summary>
        <div class="detailsBody">
          <div class="field">
            <label>Onderdelen</label>
            <textarea id="jobParts" placeholder="Bijv: remblokken ‚Ç¨80, filterset ‚Ç¨35..."></textarea>
          </div>
        </div>
      </details>

      <div class="spacer"></div>

      <details>
        <summary>Tijdregistratie <span class="muted">‚ñæ</span></summary>
        <div class="detailsBody">
          <div class="field">
            <label>Uren</label>
            <input id="jobHours" type="number" step="0.25" min="0" placeholder="Bijv: 1.5" />
          </div>
        </div>
      </details>

      <div class="spacer"></div>

      <div class="card">
        <div class="row">
          <button class="btn" id="btnMarkDone">‚úî Markeer als klaar</button>
          <button class="btn" id="btnToArchive">üìÅ Naar archief</button>
        </div>
        <div class="meta">Prototype: opslag in je browser (localStorage).</div>
      </div>
    </section>

    <!-- SCHERM 3: Archief -->
    <section id="screen-archive" class="screen">
      <div class="topbar">
        <div>
          <div class="title">Archief</div>
          <div class="sub">Afgeronde klussen</div>
        </div>
        <button class="pill" id="btnClearArchive">Leeg</button>
      </div>

      <div class="sectionTitle">Klaar</div>
      <div id="archiveList" class="stack"></div>
    </section>

  </div>

  <div class="footerNav">
    <div class="navInner">
      <button class="btn" id="navToday">Vandaag</button>
      <button class="btn" id="navArchive">Archief</button>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const screens = {
    today: $("screen-today"),
    job: $("screen-job"),
    archive: $("screen-archive"),
  };

  const STORAGE_KEY = "garage_prototype_v1";

  const statusInfo = {
    bezig:   { label: "bezig",   dot: "var(--warn)",  cls: "warn" },
    wachten:{ label: "wachten", dot: "var(--bad)",   cls: "danger" },
    klaar:  { label: "klaar",   dot: "var(--good)",  cls: "ok" },
  };

  const nowDateLine = () => {
    const d = new Date();
    return d.toLocaleDateString("nl-NL", { weekday:"long", day:"2-digit", month:"long", year:"numeric" });
  };

  function loadState(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw){
      try { return JSON.parse(raw); } catch(e) {}
    }
    // seed data (zoals jouw voorbeeld)
    return {
      today: [
        { id: "1", title: "Golf 7 ‚Äì onderhoud", plate:"12-AB-CD", status:"bezig", work:"", parts:"", hours:"", updated: Date.now() },
        { id: "2", title: "Audi A6 ‚Äì wachten",  plate:"45-EF-GH", status:"wachten", work:"", parts:"", hours:"", updated: Date.now() },
        { id: "3", title: "Transit ‚Äì APK",      plate:"89-IJ-KL", status:"klaar", work:"", parts:"", hours:"", updated: Date.now() },
      ],
      archive: []
    };
  }

  function saveState(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function showScreen(name){
    Object.values(screens).forEach(s => s.classList.remove("active"));
    screens[name].classList.add("active");
  }

  function statusChip(status){
    const info = statusInfo[status] || statusInfo.bezig;
    return info;
  }

  function renderToday(){
    $("todayDate").textContent = nowDateLine();
    const list = $("todayList");
    list.innerHTML = "";

    state.today.forEach(job => {
      const info = statusChip(job.status);

      const card = document.createElement("div");
      card.className = `card ${info.cls}`;
      card.innerHTML = `
        <div class="row">
          <div style="min-width:0">
            <div class="h" style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${escapeHtml(job.title)}</div>
            <div class="meta">${escapeHtml(job.plate)} ‚Ä¢ <span class="chip" style="margin-top:8px; display:inline-flex;">
              <span class="dot" style="background:${info.dot}"></span>${info.label}
            </span></div>
          </div>
          <button class="btn">Open</button>
        </div>
      `;

      card.querySelector("button").addEventListener("click", () => openJob(job.id));
      list.appendChild(card);
    });

    if(state.today.length === 0){
      list.innerHTML = `<div class="card"><div class="muted">Geen klussen voor vandaag.</div></div>`;
    }
  }

  function renderArchive(){
    const list = $("archiveList");
    list.innerHTML = "";

    state.archive.forEach(job => {
      const info = statusChip(job.status);
      const card = document.createElement("div");
      card.className = `card ${info.cls}`;
      card.innerHTML = `
        <div class="row">
          <div style="min-width:0">
            <div class="h" style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${escapeHtml(job.title)}</div>
            <div class="meta">${escapeHtml(job.plate)} ‚Ä¢ <span class="chip" style="margin-top:8px; display:inline-flex;">
              <span class="dot" style="background:${info.dot}"></span>${info.label}
            </span></div>
          </div>
          <button class="btn">Open</button>
        </div>
      `;
      card.querySelector("button").addEventListener("click", () => openArchivedJob(job.id));
      list.appendChild(card);
    });

    if(state.archive.length === 0){
      list.innerHTML = `<div class="card"><div class="muted">Nog niks in archief.</div></div>`;
    }
  }

  let state = loadState();
  let currentJobId = null;
  let currentIsArchived = false;

  function openJob(id){
    currentJobId = id;
    currentIsArchived = false;
    const job = state.today.find(j => j.id === id);
    if(!job) return;

    fillJobScreen(job);
    showScreen("job");
  }

  function openArchivedJob(id){
    currentJobId = id;
    currentIsArchived = true;
    const job = state.archive.find(j => j.id === id);
    if(!job) return;

    fillJobScreen(job);
    showScreen("job");
  }

  function fillJobScreen(job){
    $("jobTitle").textContent = job.title;
    $("jobSub").textContent = job.plate;

    $("jobStatus").value = job.status;
    $("jobWork").value = job.work || "";
    $("jobParts").value = job.parts || "";
    $("jobHours").value = job.hours || "";

    updateStatusUI(job.status, job.updated);
  }

  function updateStatusUI(status, updated){
    const info = statusChip(status);
    $("chipDot").style.background = info.dot;
    $("chipText").textContent = info.label;

    const d = new Date(updated || Date.now());
    $("chipUpdated").textContent = d.toLocaleString("nl-NL", { day:"2-digit", month:"2-digit", hour:"2-digit", minute:"2-digit" });
  }

  function getCurrentJob(){
    return currentIsArchived
      ? state.archive.find(j => j.id === currentJobId)
      : state.today.find(j => j.id === currentJobId);
  }

  function persistCurrentJob(){
    const job = getCurrentJob();
    if(!job) return;

    job.status = $("jobStatus").value;
    job.work = $("jobWork").value;
    job.parts = $("jobParts").value;
    job.hours = $("jobHours").value;
    job.updated = Date.now();

    updateStatusUI(job.status, job.updated);
    saveState();
    renderToday();
    renderArchive();
  }

  // Events
  $("navToday").addEventListener("click", () => { renderToday(); showScreen("today"); });
  $("navArchive").addEventListener("click", () => { renderArchive(); showScreen("archive"); });

  $("btnBackToToday").addEventListener("click", () => { renderToday(); showScreen("today"); });

  ["jobStatus","jobWork","jobParts","jobHours"].forEach(id => {
    $(id).addEventListener("input", persistCurrentJob);
    $(id).addEventListener("change", persistCurrentJob);
  });

  $("btnMarkDone").addEventListener("click", () => {
    $("jobStatus").value = "klaar";
    persistCurrentJob();
  });

  $("btnToArchive").addEventListener("click", () => {
    const job = getCurrentJob();
    if(!job) return;

    // Alleen naar archief als 'klaar' (rustig/clean)
    if(job.status !== "klaar"){
      alert("Zet status eerst op 'klaar' voordat je archiveert.");
      return;
    }

    // Verplaats uit today ‚Üí archive (als het niet al archived is)
    if(!currentIsArchived){
      state.today = state.today.filter(j => j.id !== job.id);
      state.archive.unshift(job);
      saveState();
      renderToday();
      renderArchive();
    }
    showScreen("archive");
  });

  $("btnNewJob").addEventListener("click", () => {
    const title = prompt("Nieuwe klus (bijv. 'Polo ‚Äì remmen'):");
    if(!title) return;
    const plate = prompt("Kenteken (optioneel):", "XX-YY-ZZ") || "";
    const job = {
      id: String(Date.now()),
      title: title.trim(),
      plate: plate.trim(),
      status: "bezig",
      work: "",
      parts: "",
      hours: "",
      updated: Date.now()
    };
    state.today.unshift(job);
    saveState();
    renderToday();
  });

  $("btnClearArchive").addEventListener("click", () => {
    if(confirm("Archief leegmaken?")){
      state.archive = [];
      saveState();
      renderArchive();
    }
  });

  function escapeHtml(str){
    return String(str ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // init
  saveState();
  renderToday();
  renderArchive();
})();
</script>
</body>
</html>